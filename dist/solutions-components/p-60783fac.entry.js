/*!
 * Copyright 2022 Esri
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
import{r as i,c as t,h as s,H as e,g as a}from"./p-f8be5d5f.js";import{s as l}from"./p-a29ba58a.js";import{a as n}from"./p-680420c4.js";import{g as o}from"./p-fc2277fe.js";import{g as d,h}from"./p-47e76815.js";import{l as c}from"./p-d7ddd3a2.js";import"./p-4ff653eb.js";import"./p-e1a4994d.js";
/** @license
 * Copyright 2022 Esri
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r(i){return i.reduce(((i,t)=>(Object.keys(i).indexOf(t.layerView.layer.id)>-1?(i[t.layerView.layer.id].ids=[...i[t.layerView.layer.id].ids,...t.selectedIds],i[t.layerView.layer.id].selectionSetNames.push(t.label)):i[t.layerView.layer.id]={ids:t.selectedIds,layerView:t.layerView,selectionSetNames:[t.label]},i)),{})}const p=class{constructor(s){i(this,s),this.searchConfigurationChange=t(this,"searchConfigurationChange",7),this._numSelected=0,this.addresseeLayerIds=[],this.bufferColor=[227,139,79,.8],this.bufferOutlineColor=[255,255,255],this.customLabelEnabled=void 0,this.defaultBufferDistance=void 0,this.defaultBufferUnit=void 0,this.featureEffect=void 0,this.featureHighlightEnabled=void 0,this.mapView=void 0,this.noResultText=void 0,this.searchConfiguration=void 0,this.selectionLayerIds=[],this.showSearchSettings=!0,this.sketchLineSymbol=void 0,this.sketchPointSymbol=void 0,this.sketchPolygonSymbol=void 0,this._addMap=!1,this._addTitle=!1,this._downloadActive=!0,this._exportCSV=!1,this._exportPDF=!0,this._pageType=n.LIST,this._saveEnabled=!1,this._selectionSets=[],this._translations=void 0}async mapViewWatchHandler(i){(null==i?void 0:i.popup)&&(this._popupsEnabled=null==i?void 0:i.popup.autoOpenEnabled)}async watchSearchConfigurationHandler(i,t){const s=JSON.stringify(i);s!==JSON.stringify(t)&&(this._searchConfiguration=JSON.parse(s),this.searchConfigurationChange.emit(this._searchConfiguration),this._home())}async sketchLineSymbolWatchHandler(i,t){i&&JSON.stringify(i)!==JSON.stringify(t)&&this._setLineSymbol(i)}async sketchPointSymbolWatchHandler(i,t){i&&JSON.stringify(i)!==JSON.stringify(t)&&this._setPointSymbol(i)}async sketchPolygonSymbolWatchHandler(i,t){i&&JSON.stringify(i)!==JSON.stringify(t)&&this._setPolygonSymbol(i)}async pageTypeWatchHandler(i,t){if(this._checkPopups(),this._clearHighlight(),t===n.SELECT&&await this._clearSelection(),i!==n.SELECT)return this._highlightFeatures()}selectionSetsChanged(i){this._selectionSets=[...i.detail]}async componentWillLoad(){await this._getTranslations(),await this._initModules(),this._initSymbols()}render(){return s(e,null,s("calcite-shell",null,s("calcite-action-bar",{class:"border-bottom-1 action-bar-size","expand-disabled":!0,layout:"horizontal",slot:"header"},this._getActionGroup("list-check",n.LIST,this._translations.myLists),this._getActionGroup("export",n.EXPORT,this._translations.export)),this._getPage(this._pageType)))}async _initModules(){const[i,t]=await c(["esri/geometry/geometryEngine","esri/symbols/support/jsonUtils"]);this._geometryEngine=i,this._jsonUtils=t}_initSymbols(){this._setLineSymbol(this.sketchLineSymbol),this._setPointSymbol(this.sketchPointSymbol),this._setPolygonSymbol(this.sketchPolygonSymbol)}_setLineSymbol(i){this.sketchLineSymbol="simple-line"===(null==i?void 0:i.type)?i:this._jsonUtils.fromJSON(i||{type:"esriSLS",color:[130,130,130,255],width:2,style:"esriSLSSolid"})}_setPointSymbol(i){this.sketchPointSymbol="simple-marker"===(null==i?void 0:i.type)?i:this._jsonUtils.fromJSON(i||{type:"esriSMS",color:[255,255,255,255],angle:0,xoffset:0,yoffset:0,size:6,style:"esriSMSCircle",outline:{type:"esriSLS",color:[50,50,50,255],width:1,style:"esriSLSSolid"}})}_setPolygonSymbol(i){this.sketchPolygonSymbol="simple-fill"===(null==i?void 0:i.type)?i:this._jsonUtils.fromJSON(i||{type:"esriSFS",color:[150,150,150,51],outline:{type:"esriSLS",color:[50,50,50,255],width:2,style:"esriSLSSolid"},style:"esriSFSSolid"})}_getActionGroup(i,t,e){return s("calcite-action-group",{class:"action-center w-1-2",layout:"horizontal"},s("calcite-action",{active:this._pageType===t,alignment:"center",class:"width-full height-full",compact:!1,icon:i,id:i,onClick:()=>{this._setPageType(t)},text:""}),s("calcite-tooltip",{label:"",placement:"bottom","reference-element":i},s("span",null,e)))}_setPageType(i){this._pageType=i}_getPage(i){let t;switch(i){case n.LIST:t=this._getListPage();break;case n.SELECT:t=this._getSelectPage();break;case n.EXPORT:t=this._getExportPage()}return t}_getListPage(){const i=this._hasSelections();return s("calcite-panel",null,this._getLabel(this._translations.myLists),this._getNotice(i?this._translations.listHasSetsTip:this._translations.selectLayerAndAdd,"padding-sides-1 padding-bottom-1"),i?this._getSelectionSetList():null,s("div",{class:"display-flex padding-1"},s("calcite-button",{onClick:()=>{this._setPageType(n.SELECT)},width:"full"},this._translations.add)))}_getSelectionSetList(){return s("div",{class:"padding-top-1-2 padding-bottom-1-2"},s("calcite-list",{class:"list-border margin-sides-1"},this._selectionSets.reduce(((i,t,e)=>(i.push(s("calcite-list-item",{description:this._translations.selectedFeatures.replace("{{n}}",t.selectedIds.length.toString()),label:t.label,onClick:()=>this._gotoSelection(t,this.mapView)},this._getAction(!0,"pencil","",(i=>this._openSelection(t,i)),!1,"actions-end"),this._getAction(!0,"x","",(i=>this._deleteSelection(e,i)),!1,"actions-end"))),i)),[])))}_hasSelections(){return this._selectionSets.length>0}_hasDuplicates(){const i=this._getSelectedIds();return this._getNumDuplicates(i)>0}_getNumDuplicates(i){return i.length-new Set(i).size}_getSelectedIds(){return this._selectionSets.reduce(((i,t)=>i.concat(t.download?t.selectedIds:[])),[])}_getSelectPage(){const i=this._translations.selectSearchTip;return s("calcite-panel",null,this._getLabel(this._translations.stepTwoFull,!0),this._getNotice(i),s("div",{class:"padding-top-1"},s("map-select-tools",{bufferColor:this.bufferColor,bufferOutlineColor:this.bufferOutlineColor,class:"font-bold",customLabelEnabled:this.customLabelEnabled,defaultBufferDistance:this.defaultBufferDistance,defaultBufferUnit:this.defaultBufferUnit,enabledLayerIds:this.selectionLayerIds,isUpdate:!!this._activeSelection,mapView:this.mapView,noResultText:this.noResultText,onSelectionSetChange:i=>this._updateForSelection(i),ref:i=>{this._selectTools=i},searchConfiguration:this._searchConfiguration,selectionSet:this._activeSelection,sketchLineSymbol:this.sketchLineSymbol,sketchPointSymbol:this.sketchPointSymbol,sketchPolygonSymbol:this.sketchPolygonSymbol})),this._getPageNavButtons(this._translations.done,0===this._numSelected,(()=>{this._saveSelection()}),this._translations.cancel,!1,(()=>{this._home()})))}_getExportPage(){const i=this._hasSelections(),t=this._getNumDuplicates(this._getSelectedIds());return s("calcite-panel",null,s("div",null,this._getLabel(this._translations.export,!0),i?s("div",null,this._getNotice(this._translations.exportTip,"padding-top-sides-1"),this._getLabel(this._translations.myLists),this._getSelectionLists(),s("div",{class:"padding-sides-1"},s("calcite-label",{layout:"inline"},s("calcite-checkbox",{ref:i=>{this._removeDuplicates=i}}),s("div",{class:"display-flex"},this._translations.removeDuplicate,s("div",{class:"info-message padding-start-1-2"},s("calcite-input-message",{class:"info-blue margin-top-0",scale:"m"},` ${this._translations.numDuplicates.replace("{{n}}",t.toString())}`))))),s("div",{class:"border-bottom"}),this._getPDFOptions(),s("div",{class:"border-bottom"}),this._getCSVOptions(),s("div",{class:"padding-1 display-flex"},s("calcite-button",{disabled:!this._downloadActive,onClick:()=>this._export(),width:"full"},this._translations.export))):this._getNotice(this._translations.downloadNoLists,"padding-sides-1 padding-bottom-1")))}_getPDFOptions(){const i=this._exportPDF?"display-block":"display-none",t=this._addTitle?"display-block":"display-none",e=this._addMap?"display-block":"display-none";return s("div",null,this._getLabel(this._translations.pdf,!0),s("div",{class:"padding-1 display-flex"},s("calcite-label",{class:"label-margin-0 "},this._translations.exportPDF),s("calcite-switch",{checked:this._exportPDF,class:"position-right",onCalciteSwitchChange:()=>this._exportPDF=!this._exportPDF})),s("div",{class:i},s("div",{class:"padding-sides-1"},s("calcite-label",{class:"label-margin-0"},this._translations.selectPDFLabelOption)),s("div",{class:"padding-sides-1"},s("pdf-download",{disabled:!this._downloadActive,ref:i=>{this._downloadTools=i}})),s("div",{class:"padding-top-sides-1"},s("calcite-label",{layout:"inline"},s("calcite-checkbox",{checked:this._addMap,onCalciteCheckboxChange:()=>this._addMap=!this._addMap}),this._translations.includeMap)),s("div",{class:e+" padding-bottom-1"},s("div",{class:"padding-top-sides-1"},s("calcite-label",{class:"label-margin-0",layout:"inline"},s("calcite-checkbox",{checked:this._addTitle,onCalciteCheckboxChange:()=>this._addTitle=!this._addTitle}),this._translations.addTitle)),s("div",{class:t},this._getLabel(this._translations.title,!0,""),s("calcite-input-text",{class:"padding-sides-1",placeholder:this._translations.titlePlaceholder,ref:i=>{this._title=i}})))))}_getCSVOptions(){return s("div",null,s("div",{class:"padding-top-sides-1"},s("calcite-label",{class:"font-bold"},this._translations.csv)),s("div",{class:"padding-sides-1 display-flex"},s("calcite-label",null,this._translations.exportCSV),s("calcite-switch",{checked:this._exportCSV,class:"position-right",onCalciteSwitchChange:()=>this._exportCSV=!this._exportCSV})))}_getPageNavButtons(i,t,e,a,l,n){return s("div",null,s("div",{class:"display-flex padding-top-sides-1"},s("calcite-button",{disabled:t,onClick:e,width:"full"},i)),s("div",{class:"display-flex padding-top-1-2 padding-sides-1"},s("calcite-button",{appearance:"outline",disabled:l,onClick:n,width:"full"},a)))}_getNotice(i,t="padding-1"){return s("calcite-notice",{class:t,icon:"lightbulb",kind:"success",open:!0},s("div",{slot:"message"},i))}_getLabel(i,t=!1,e="font-bold"){return s("div",{class:"padding-top-sides-1"},s("calcite-label",{class:e+=t?" label-margin-0":""},i))}_getSelectionLists(){return this._selectionSets.reduce(((i,t)=>(!this._downloadActive&&t.download&&(this._downloadActive=!0),i.push(s("div",{class:"display-flex padding-sides-1 padding-bottom-1"},s("calcite-checkbox",{checked:t.download,class:"align-center",onClick:()=>{this._toggleDownload(t.id)}}),s("calcite-list",{class:"list-border margin-start-1-2 width-full",id:"download-list"},s("calcite-list-item",{description:this._translations.selectedFeatures.replace("{{n}}",t.selectedIds.length.toString()),disabled:!t.download,label:t.label,onClick:()=>{this._toggleDownload(t.id)}})))),i)),[])||s("div",null)}async _toggleDownload(i){let t=!1;this._selectionSets=this._selectionSets.map((s=>(s.download=s.id===i?!s.download:s.download,t=!!s.download||t,s))),this._downloadActive=t,await this._highlightFeatures()}_export(){this._exportPDF&&this._downloadPDF(),this._exportCSV&&this._downloadCSV()}async _downloadPDF(){let i;this._addMap&&this.mapView&&(i=await this.mapView.takeScreenshot({width:1500,height:2e3}),console.log("screenshot",i));const t=r(this._getDownloadSelectionSets());Object.keys(t).forEach((i=>{const s=t[i];this._downloadTools.downloadPDF(s.layerView,s.selectionSetNames,s.ids,this._removeDuplicates.checked,this._addTitle?this._title.value:"")}))}_downloadCSV(){const i=r(this._getDownloadSelectionSets());Object.keys(i).forEach((t=>{const s=i[t];this._downloadTools.downloadCSV(s.layerView,s.selectionSetNames,s.ids,this._removeDuplicates.checked)}))}_getDownloadSelectionSets(){return this._selectionSets.filter((i=>i.download))}_getAction(i,t,e,a,l=!1,n=""){return s("calcite-action",{disabled:!i,icon:t,indicator:l,onClick:a,slot:n,text:e})}_updateForSelection(i){this._numSelected=i.detail,this._saveEnabled=this._numSelected>0}async _home(){await this._clearSelection(),"boolean"==typeof this._popupsEnabled&&this.mapView.popup&&(this.mapView.popup.autoOpenEnabled=this._popupsEnabled),this._setPageType(n.LIST)}async _saveSelection(){var i,t;const s=await(null===(i=this._selectTools)||void 0===i?void 0:i.getSelection()),e=null===(t=this._selectTools)||void 0===t?void 0:t.isUpdate;return this._selectionSets=e?this._selectionSets.map((i=>i.id===s.id?s:i)):[...this._selectionSets,s],this._home()}async _clearSelection(){var i;await(null===(i=this._selectTools)||void 0===i?void 0:i.clearSelection()),this._numSelected=0,this._activeSelection=void 0}_deleteSelection(i,t){return t.stopPropagation(),this._selectionSets=this._selectionSets.filter(((t,s)=>{if(s!==i)return t})),this._highlightFeatures()}_gotoSelection(i,t){d(i.selectedIds,i.layerView,t,this.featureHighlightEnabled,this.featureEffect)}_openSelection(i,t){t.stopPropagation(),this._activeSelection=i,this._pageType=n.SELECT}async _highlightFeatures(){this._clearHighlight();const i=r(this._selectionSets),t=Object.keys(i);if(t.length>0)for(let s=0;s<t.length;s++){const e=i[t[s]];l.highlightHandles.push(await h(e.ids,e.layerView,this.mapView))}}_checkPopups(){var i;"boolean"!=typeof this._popupsEnabled&&(this._popupsEnabled=null===(i=this.mapView)||void 0===i?void 0:i.popup.autoOpenEnabled)}_clearHighlight(){l&&l.highlightHandles&&l.removeHandles()}async _getTranslations(){const i=await o(this.el);this._translations=i[0]}get el(){return a(this)}static get watchers(){return{mapView:["mapViewWatchHandler"],searchConfiguration:["watchSearchConfigurationHandler"],sketchLineSymbol:["sketchLineSymbolWatchHandler"],sketchPointSymbol:["sketchPointSymbolWatchHandler"],sketchPolygonSymbol:["sketchPolygonSymbolWatchHandler"],_pageType:["pageTypeWatchHandler"]}}};p.style=':host{display:block;--calcite-input-message-spacing-value:0}.align-center{align-items:center}.border-bottom-1{border-width:0px;border-bottom-width:1px;border-style:solid;border-color:var(--calcite-ui-border-3)}.action-bar-size{height:3.5rem;width:100%}.w-1-2{width:50%}.action-center{-webkit-box-align:center;-webkit-align-items:center;-ms-grid-row-align:center;align-items:center;align-content:center;justify-content:center}.width-full{width:100%}.height-full{height:100%}.padding-1{padding:1rem}.padding-top-sides-1{-webkit-padding-before:1rem;padding-block-start:1rem;-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem}.padding-sides-1{-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem}.padding-end-1-2{-webkit-padding-end:.5rem;padding-inline-end:.5rem}.padding-top-1-2{-webkit-padding-before:.5rem;padding-block-start:.5rem}.padding-top-1{padding-top:1rem}.padding-bottom-1{padding-bottom:1rem}.padding-bottom-1-2{padding-bottom:.5rem}.info-blue{color:#00A0FF}.info-message{justify-content:center;display:grid}.font-bold{font-weight:bold}.display-flex{display:flex}.display-block{display:block}.display-none{display:none}.border-bottom{border-bottom:1px solid var(--calcite-ui-border-2)}.padding-start-1-2{-webkit-padding-start:0.5rem;padding-inline-start:0.5rem}.list-border{border:1px solid var(--calcite-ui-border-2)}.margin-sides-1{-webkit-margin-start:1rem;margin-inline-start:1rem;-webkit-margin-end:1rem;margin-inline-end:1rem}.margin-start-1-2{-webkit-margin-start:0.5rem;margin-inline-start:0.5rem}.float-right{float:right}.float-right[dir="rtl"]{float:left}.float-left{float:left}.float-left[dir="rtl"]{float:right}.margin-top-0{-webkit-margin-before:0 !important;margin-block-start:0 !important}.height-1-1-2{height:1.5rem}.main-background{background-color:var(--calcite-ui-foreground-2)}.position-right{position:absolute;right:1rem}.position-right[dir="rtl"]{position:absolute;left:1rem}.label-margin-0{--calcite-label-margin-bottom:0}';export{p as public_notification}