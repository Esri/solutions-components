/*!
 * Copyright 2022 Esri
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
import{r as i,h as t,H as e,g as s}from"./p-c023e6a1.js";import{b as a,c as l,E as n,d}from"./p-be41429f.js";import{l as o}from"./p-1c567f3a.js";import{b as c,d as r,a as h,h as p}from"./p-7dcab29d.js";import{s as g}from"./p-15cd8a97.js";import{g as b}from"./p-44da2507.js";import{g as m,a as u}from"./p-fc884dd6.js";import"./p-4307dacd.js";import"./p-3b010ce1.js";const f=class{constructor(t){i(this,t),this.addresseeLayer=void 0,this.mapView=void 0,this.showRefineSelection=!1,this._downloadActive=!0,this._numSelected=0,this._pageType=a.LIST,this._saveEnabled=!1,this._selectionSets=[],this._sketchType=l.INTERACTIVE,this._selectionWorkflowType=n.SEARCH,this._translations=void 0}async mapViewWatchHandler(i){(null==i?void 0:i.popup)&&(this._popupsEnabled=null==i?void 0:i.popup.autoOpenEnabled)}async selectionSetsWatchHandler(i,t){i&&i!==t&&i.length>0&&0===i.filter((i=>i.workflowType!==n.REFINE)).length&&(this._selectionSets=[])}async pageTypeWatchHandler(i,t){if(this._checkPopups(),this._clearHighlight(),t!==a.SELECT&&t!==a.REFINE||await this._clearSelection(),i!==a.SELECT)return this._highlightFeatures()}selectionSetsChanged(i){this._selectionSets=[...i.detail]}sketchTypeChange(i){this._sketchType=i.detail}async componentWillLoad(){await this._getTranslations(),await this._initModules()}render(){const i=this._selectionSets.length>0;return t(e,null,t("calcite-shell",null,t("calcite-action-bar",{class:"border-bottom-1 action-bar-size","expand-disabled":!0,layout:"horizontal",slot:"header"},this._getActionGroup("list-check",!1,a.LIST,this._translations.myLists),this.showRefineSelection?this._getActionGroup("test-data",!i,a.REFINE,this._translations.refineSelection):void 0,this._getActionGroup("file-pdf",!i,a.PDF,this._translations.downloadPDF),this._getActionGroup("file-csv",!i,a.CSV,this._translations.downloadCSV)),this._getPage(this._pageType)))}async _initModules(){const[i]=await o(["esri/geometry/geometryEngine"]);this._geometryEngine=i}_getActionGroup(i,e,s,a){return t("calcite-action-group",{class:this.showRefineSelection?"action-center w-1-4":"action-center w-1-3",layout:"horizontal"},t("calcite-action",{active:this._pageType===s,alignment:"center",class:"width-full height-full",compact:!1,disabled:e,icon:i,id:i,onClick:()=>{this._setPageType(s)},text:""}),t("calcite-tooltip",{label:"",placement:"bottom","reference-element":i},t("span",null,a)))}_setPageType(i){this._pageType=i}_getPage(i){let t;switch(i){case a.LIST:t=this._getListPage();break;case a.SELECT:t=this._getSelectPage();break;case a.REFINE:t=this._getRefinePage();break;case a.PDF:t=this._getPDFPage();break;case a.CSV:t=this._getCSVPage()}return t}_getListPage(){var i,e;const s=this._selectionSets.filter((i=>i.workflowType!==n.REFINE)).length>0,l=m(this._selectionSets);return s?t("calcite-panel",null,t("div",{class:"padding-top-sides-1"},t("calcite-label",{class:"font-bold"},this._translations.myLists)),this._getNotice(this._translations.listHasSetsTip,"padding-sides-1 padding-bottom-1"),t("div",{class:"display-flex padding-sides-1"},t("calcite-label",{class:"font-bold width-full"},this._translations.addresseeLayer,t("map-layer-picker",{mapView:this.mapView,onLayerSelectionChange:i=>this._layerSelectionChange(i),selectedLayers:this.addresseeLayer?[null===(i=this.addresseeLayer)||void 0===i?void 0:i.layer.title]:[],selectionMode:"single"}))),t("div",{class:"padding-sides-1 height-1-1-2"},t("div",{class:"position-left"},t("calcite-label",{alignment:"start",class:"font-bold"},this._translations.notifications)),t("div",{class:"position-right"},t("calcite-input-message",{active:!0,class:"info-blue margin-top-0",scale:"m"},this._translations.uniqueCout.replace("{{n}}",l.toString())))),s?this._getSelectionSetList():t("div",{class:"info-message"},t("calcite-input-message",{active:!0,class:"info-blue",scale:"m"},this._translations.noNotifications)),t("div",{class:"display-flex padding-1"},t("calcite-button",{onClick:()=>{this._setPageType(a.SELECT)},width:"full"},this._translations.add))):t("calcite-panel",null,t("div",{class:"padding-top-sides-1"},t("calcite-label",{class:"font-bold"},this._translations.myLists)),t("div",{class:"padding-sides-1"},t("calcite-label",null,this._translations.notifications)),t("div",{class:"info-message padding-bottom-1"},t("calcite-input-message",{active:!0,class:"info-blue",scale:"m"},this._translations.noNotifications)),this._getNotice(this._translations.selectLayerAndAdd,"padding-sides-1 padding-bottom-1"),t("div",{class:"display-flex padding-sides-1"},t("calcite-label",{class:"font-bold width-full"},this._translations.addresseeLayer,t("map-layer-picker",{mapView:this.mapView,onLayerSelectionChange:i=>this._layerSelectionChange(i),selectedLayers:this.addresseeLayer?[null===(e=this.addresseeLayer)||void 0===e?void 0:e.layer.title]:[],selectionMode:"single"}))),t("div",{class:"display-flex padding-1"},t("calcite-button",{onClick:()=>{this._setPageType(a.SELECT)},width:"full"},this._translations.add)))}_getSelectionSetList(){return t("calcite-list",{class:"list-border margin-sides-1"},this._selectionSets.reduce(((i,e,s)=>(e.workflowType!==n.REFINE&&i.push(t("calcite-list-item",{description:this._translations.selectedFeatures.replace("{{n}}",e.selectedIds.length.toString()),label:e.label,onClick:()=>this._gotoSelection(e,this.mapView)},this._getAction(!0,"pencil","",(i=>this._openSelection(e,i)),!1,"actions-end"),this._getAction(!0,"x","",(i=>this._deleteSelection(s,i)),!1,"actions-end"))),i)),[]))}_getSelectPage(){var i,e;const s=this._selectionWorkflowType===n.SELECT?this._translations.selectLayerTip:this._selectionWorkflowType===n.SKETCH?this._sketchType===l.INTERACTIVE?this._translations.selectSketchTip:this._translations.selectLayerTip:this._translations.selectSearchTip;return t("calcite-panel",null,this._getLabel(this._translations.stepTwoFull.replace("{{layer}}",null===(i=this.addresseeLayer)||void 0===i?void 0:i.layer.title)),this._getNotice(s),t("div",{class:"padding-1"},t("map-select-tools",{class:"font-bold",isUpdate:!!this._activeSelection,mapView:this.mapView,onSelectionSetChange:i=>this._updateForSelection(i),onWorkflowTypeChange:i=>this._updateForWorkflowType(i),ref:i=>{this._selectTools=i},selectLayerView:this.addresseeLayer,selectionSet:this._activeSelection})),t("div",{class:"padding-sides-1 padding-bottom-1",style:{"align-items":"end",display:"flex"}},t("calcite-icon",{class:"info-blue padding-end-1-2",icon:"feature-layer",scale:"s"}),t("calcite-input-message",{active:!0,class:"info-blue",scale:"m"},this._translations.selectedAddresses.replace("{{n}}",this._numSelected.toString()).replace("{{layer}}",(null===(e=this.addresseeLayer)||void 0===e?void 0:e.layer.title)||""))),this._getPageNavButtons(this._translations.done,0===this._numSelected,(()=>{this._saveSelection()}),this._translations.cancel,!1,(()=>{this._home()})))}_getRefinePage(){return t("calcite-panel",null,this._getLabel(this._translations.refineSelection),this._getNotice(this._translations.refineTip,"padding-sides-1"),t("refine-selection",{addresseeLayer:this.addresseeLayer,mapView:this.mapView,selectionSets:this._selectionSets}))}_getPDFPage(){return this._getDownloadPage(d.PDF)}_getCSVPage(){return this._getDownloadPage(d.CSV)}_getDownloadPage(i){const e=i===d.PDF;return t("calcite-panel",null,t("div",null,t("div",{class:"padding-top-sides-1"},t("calcite-label",{class:"font-bold"},e?this._translations.pdfDownloads:this._translations.csvDownloads),t("calcite-label",null,this._translations.notifications)),this._getSelectionLists(),t("div",{class:"margin-side-1 padding-top-1 border-bottom"}),t("div",{class:"padding-top-sides-1"},t("calcite-label",{layout:"inline"},t("calcite-checkbox",{disabled:!this._downloadActive,ref:i=>{this._removeDuplicates=i}}),this._translations.removeDuplicate)),t("div",{class:e?"":"display-none"},this._getLabel(this._translations.selectPDFLabelOption,!1),t("div",{class:"padding-sides-1"},t("pdf-download",{disabled:!this._downloadActive,layerView:this.addresseeLayer,ref:i=>{this._downloadTools=i}}))),t("div",{class:"padding-1 display-flex"},t("calcite-button",{disabled:!this._downloadActive,onClick:e?()=>this._downloadPDF():()=>this._downloadCSV(),width:"full"},e?this._translations.downloadPDF:this._translations.downloadCSV))))}_getPageNavButtons(i,e,s,a,l,n){return t("div",null,t("div",{class:"display-flex padding-top-sides-1"},t("calcite-button",{disabled:e,onClick:s,width:"full"},i)),t("div",{class:"display-flex padding-top-1-2 padding-sides-1"},t("calcite-button",{appearance:"outline",disabled:l,onClick:n,width:"full"},a)))}_getNotice(i,e="padding-1"){return t("calcite-notice",{class:e,color:"green",icon:"lightbulb",open:!0},t("div",{slot:"message"},i))}_getLabel(i,e=!1){return t("div",{class:"padding-top-sides-1"},t("calcite-label",{class:"font-bold","disable-spacing":e},i))}_getSelectionLists(){return this._selectionSets.reduce(((i,e)=>(e.workflowType!==n.REFINE&&(!this._downloadActive&&e.download&&(this._downloadActive=!0),i.push(t("div",{class:"display-flex padding-sides-1 padding-bottom-1"},t("calcite-checkbox",{checked:e.download,onClick:()=>{this._toggleDownload(e.id)}}),t("calcite-list",{class:"list-border margin-start-1-2 w-100",id:"download-list"},t("calcite-list-item",{description:this._translations.selectedFeatures.replace("{{n}}",e.selectedIds.length.toString()),disabled:!e.download,label:e.label,onClick:()=>{this._toggleDownload(e.id)}}))))),i)),[])||t("div",null)}async _toggleDownload(i){let t=!1;this._selectionSets=this._selectionSets.map((e=>(e.download=e.id===i?!e.download:e.download,t=!!e.download||t,e))),this._downloadActive=t,await this._highlightFeatures()}_downloadPDF(){const i=u(this._getDownloadSelectionSets());this._downloadTools.downloadPDF(i,this._removeDuplicates.checked)}_downloadCSV(){const i=u(this._getDownloadSelectionSets());this._downloadTools.downloadCSV(i,this._removeDuplicates.checked)}_getDownloadSelectionSets(){return this._selectionSets.filter((i=>i.download||i.workflowType===n.REFINE))}_updateForWorkflowType(i){this._selectionWorkflowType=i.detail}_getAction(i,e,s,a,l=!1,n=""){return t("calcite-action",{disabled:!i,icon:e,indicator:l,onClick:a,slot:n,text:s})}_updateForSelection(i){this._numSelected=i.detail,this._saveEnabled=this._numSelected>0}async _home(){await this._clearSelection(),"boolean"==typeof this._popupsEnabled&&this.mapView.popup&&(this.mapView.popup.autoOpenEnabled=this._popupsEnabled),this._setPageType(a.LIST)}async _layerSelectionChange(i){var t,e;const s=(null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.length)>0?i.detail[0]:"";s!==(null===(e=this.addresseeLayer)||void 0===e?void 0:e.layer.title)&&(this.addresseeLayer=await c(this.mapView,s),await this._updateSelectionSets(this.addresseeLayer))}async _updateSelectionSets(i){const t=this._selectionSets.filter((i=>i.workflowType!==n.REFINE)),e=[];return t.forEach((t=>{t.layerView=i,t.selectedIds=[],e.push(r(t,this._geometryEngine))})),Promise.all(e).then((async i=>{i.forEach(((i,e)=>{t[e].selectedIds=i})),await this._highlightFeatures(),this._selectionSets=[...t]}))}async _saveSelection(){var i,t;const e=await(null===(i=this._selectTools)||void 0===i?void 0:i.getSelection()),s=null===(t=this._selectTools)||void 0===t?void 0:t.isUpdate;return this._selectionSets=s?this._selectionSets.map((i=>i.id===e.id?e:i)):[...this._selectionSets,e],this._home()}async _clearSelection(){var i;await(null===(i=this._selectTools)||void 0===i?void 0:i.clearSelection()),this._numSelected=0,this._activeSelection=void 0}_deleteSelection(i,t){return t.stopPropagation(),this._selectionSets=this._selectionSets.filter(((t,e)=>{if(e!==i)return t})),this._highlightFeatures()}_gotoSelection(i,t){h(i.selectedIds,i.layerView,t)}_openSelection(i,t){t.stopPropagation(),this._activeSelection=i,this._pageType=a.SELECT}async _highlightFeatures(){this._clearHighlight();const i=u(this._selectionSets);i.length>0&&(g.highlightHandle=await p(i,this.addresseeLayer,this.mapView))}_checkPopups(){var i;"boolean"!=typeof this._popupsEnabled&&(this._popupsEnabled=null===(i=this.mapView)||void 0===i?void 0:i.popup.autoOpenEnabled)}_clearHighlight(){var i;g&&g.highlightHandle&&(null===(i=g.highlightHandle)||void 0===i||i.remove())}async _getTranslations(){const i=await b(this.el);this._translations=i[0]}get el(){return s(this)}static get watchers(){return{mapView:["mapViewWatchHandler"],_selectionSets:["selectionSetsWatchHandler"],_pageType:["pageTypeWatchHandler"]}}};f.style=':host{display:block}.border-bottom-1{border-width:0px;border-bottom-width:1px;border-style:solid;border-color:var(--calcite-ui-border-3)}.action-bar-size{height:3.5rem;width:100%}.w-1-3{width:33.3%}.w-1-4{width:25%}.action-center{-webkit-box-align:center;-webkit-align-items:center;-ms-grid-row-align:center;align-items:center;align-content:center;justify-content:center}.width-full{width:100%}.height-full{height:100%}.padding-1{padding:1rem}.padding-top-sides-1{-webkit-padding-before:1rem;padding-block-start:1rem;-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem}.padding-sides-1{-webkit-padding-start:1rem;padding-inline-start:1rem;-webkit-padding-end:1rem;padding-inline-end:1rem}.padding-end-1-2{-webkit-padding-end:.5rem;padding-inline-end:.5rem}.padding-top-1-2{-webkit-padding-before:.5rem;padding-block-start:.5rem}.padding-top-1{padding-top:1rem}.padding-bottom-1{padding-bottom:1rem}.info-blue{color:#00A0FF}.info-message{justify-content:center;display:grid}.font-bold{font-weight:bold}.display-flex{display:flex}.display-block{display:block}.display-none{display:none}.main-label{float:left}html[dir="rtl"] .main-label{float:right}.back-label:hover{cursor:pointer;color:var(--calcite-ui-brand-hover)}.border-bottom{border-bottom:1px solid var(--calcite-ui-border-2)}.margin-side-1{-webkit-margin-start:1rem;margin-inline-start:1rem;-webkit-margin-end:1rem;margin-inline-end:1rem}.border-top{border-top:1px solid var(--calcite-ui-border-2)}.w-100{width:100%}.w-50{width:50%}.padding-1-2{padding:0.5rem}.list-border{border:1px solid var(--calcite-ui-border-2)}.margin-sides-1{-webkit-margin-start:1rem;margin-inline-start:1rem;-webkit-margin-end:1rem;margin-inline-end:1rem}.margin-start-1-2{-webkit-margin-start:0.5rem;margin-inline-start:0.5rem}.position-right{position:absolute;right:1rem}.position-right[dir="rtl"]{position:absolute;left:1rem}.position-left{position:absolute;left:1rem}.position-left[dir="rtl"]{position:absolute;right:1rem}.margin-top-0{-webkit-margin-before:0 !important;margin-block-start:0 !important}.height-1-1-2{height:1.5rem}.main-background{background-color:var(--calcite-ui-foreground-2)}';export{f as public_notification}