/*!
 * Copyright 2022 Esri
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
import{r as t,h as i,H as e,g as s,c as a}from"./p-f8be5d5f.js";import{l as o}from"./p-d7ddd3a2.js";import{g as l}from"./p-fc2277fe.js";import{e as n,b as c,g as h,f as r}from"./p-47e76815.js";import{d}from"./p-551cdba6.js";import{d as p}from"./p-680420c4.js";import"./p-e1a4994d.js";const m=class{constructor(i){t(this,i),this._fieldNames=[],this._graphics=[],this.onTableNodeCreate=t=>{this._tableNode=t,this._getTable(t)},this.mapView=void 0,this._layerView=void 0,this._selectedIndexes=[],this._translations=void 0}async mapViewWatchHandler(){const t=await n(this.mapView);this._layerView=await c(this.mapView,t[0])}async componentWillLoad(){await this._getTranslations(),await this._initModules()}render(){return this._layerView?i(e,null,this._getTableControlRow(),i("div",{class:"table-div width-full"},i("calcite-panel",{class:"height-full width-full"},i("div",{ref:this.onTableNodeCreate}))),i("edit-record-modal",{ref:t=>this._editMultipleMpdal=t})):null}async _initModules(){const[t]=await o(["esri/widgets/FeatureTable"]);this.FeatureTable=t}_getTableControlRow(){const t=this._selectedIndexes.length>0,e=this._selectedIndexes.length>1;return i("div",{class:"display-flex table-border"},i("map-layer-picker",{mapView:this.mapView,onLayerSelectionChange:t=>this._layerSelectionChanged(t)}),i("div",null,i("calcite-button",{appearance:"transparent",color:"neutral",disabled:!t,iconStart:"magnifying-glass",onClick:()=>this._zoom()},this._translations.zoom),i("calcite-button",{appearance:"transparent",color:"neutral",disabled:!e,iconStart:"pencil",onClick:()=>this._editMultiple()},this._translations.editMultiple),i("calcite-button",{appearance:"transparent",color:"neutral",disabled:!t,iconStart:"trash",onClick:()=>this._delete()},this._translations.delete),i("calcite-split-button",{appearance:"transparent",color:"neutral","primary-text":this._translations.more},i("calcite-dropdown-group",{"selection-mode":"none"},i("calcite-dropdown-item",{iconStart:"list-check-all",onClick:()=>this._selectAll(!0)},this._translations.selectAll),i("calcite-dropdown-item",{iconStart:"selected-items-filter",onClick:()=>this._showSelected()},this._translations.showSelected),i("calcite-dropdown-item",{iconStart:"erase",onClick:()=>this._clearSelection()},this._translations.clearSelection),i("calcite-dropdown-item",{iconStart:"refresh",onClick:()=>this._switchSelected()},this._translations.switchSelected),i("calcite-dropdown-item",{iconStart:"export",onClick:()=>this._exportToCSV()},this._translations.exportCSV)))))}_getTable(t){var i;(null===(i=this._layerView)||void 0===i?void 0:i.layer)&&(this._table=new this.FeatureTable({layer:this._layerView.layer,view:this.mapView,editingEnabled:!0,highlightOnRowSelectEnabled:!0,multiSortEnabled:!1,visibleElements:{header:!1,menu:!1},container:t}))}_selectAll(t){this._selectedIndexes=t?this._graphics.map(((t,i)=>i)):[]}_showSelected(){console.log("_showSelected")}_clearSelection(){this._selectedIndexes=[]}_switchSelected(){const t=[...this._selectedIndexes];this._selectedIndexes=this._graphics.reduce(((i,e,s)=>(t.indexOf(s)<0&&i.push(s),i)),[])}_exportToCSV(){d([],this._layerView.layer,this._getSelectedIds(),!1,!1,!0)}_zoom(){const t=this._getSelectedIds();h(t,this._layerView,this.mapView,!0)}_editMultiple(){this._editMultipleMpdal.open=!0}_delete(){console.log("delete")}_getGraphics(t){return this._graphics.filter(((i,e)=>t.indexOf(e)>-1))}_getSelectedIds(){return this._getGraphics(this._selectedIndexes).map((t=>t.getObjectId()))}_rowSelected(t){const i=this._selectedIndexes.indexOf(t);i>-1?(this._selectedIndexes.splice(i,1),this._selectedIndexes=[...this._selectedIndexes]):this._selectedIndexes=[...this._selectedIndexes,t]}async _layerSelectionChanged(t){const i=t.detail[0];this._layerView=await c(this.mapView,i),this._fieldNames=this._layerView.layer.fields.map((t=>t.alias||t.name)),this._graphics=await r(0,this._layerView.layer,[]),this._selectedIndexes=[],this._table.layer=this._layerView.layer,this._table.render()}async _getTranslations(){const t=await l(this.el);this._translations=t[0]}get el(){return s(this)}static get watchers(){return{mapView:["mapViewWatchHandler"]}}};m.style=":host{display:block}.table-div{height:calc(100% - 35px)}.display-flex{display:flex}.table-border{border:1px solid var(--calcite-ui-border-2)}";const u=class{constructor(i){t(this,i),this.expandMap=a(this,"expandMap",7),this.mapChanged=a(this,"mapChanged",7),this._loadedId="",this.mapInfos=[],this.mapView=void 0,this._mapListExpanded=!1,this._translations=void 0,this._webMapId=""}_webMapIdWatchHandler(t,i){t&&JSON.stringify(t)!==JSON.stringify(i)&&this._loadMap(t)}mapInfosWatchHandler(t,i){t&&JSON.stringify(t)!==JSON.stringify(i)&&this._loadMap(t[0].id)}async componentWillLoad(){await this._getTranslations(),await this._initModules()}componentDidRender(){this._loadMap(this._webMapId)}render(){return i(e,null,this._getToolbar(),this._getMapNameList(this._mapListExpanded),i("div",{class:"map-height",ref:t=>this._mapDiv=t}))}async _initModules(){const[t,i]=await o(["esri/WebMap","esri/views/MapView"]);this.WebMap=t,this.MapView=i}_getToolbar(){return i("div",{class:"display-flex"},i("calcite-action-bar",{class:"border-bottom-1 action-bar-size","expand-disabled":!0,layout:"horizontal",slot:"header"},this._getMapPicker(),this._getActionGroup("home",!1,this._translations.home,(()=>this._goHome())),this._getActionGroup("list",!1,this._translations.list,(()=>this._showList())),this._getActionGroup("magnifying-glass-plus",!1,this._translations.search,(()=>this._search())),this._getActionGroup("plus",!1,this._translations.zoomIn,(()=>this._zoomIn())),this._getActionGroup("minus",!1,this._translations.zoomOut,(()=>this._zoomOut())),this._getActionGroup("expand",!1,this._translations.expand,(()=>this._expand()))))}_loadMap(t){if(""===t&&this.mapInfos.length>0&&(t=this.mapInfos[0].id),this._loadedId!==t){const i=new this.WebMap({portalItem:{id:t}});this.mapView=new this.MapView({container:this._mapDiv,map:i,resizeAlign:"top-left"}),this._loadedId=t,this.mapChanged.emit(this.mapView)}}_getActionGroup(t,e,s,a){return i("calcite-action-group",{class:"action-center width-1-6",layout:"horizontal"},i("calcite-action",{alignment:"center",class:"width-full height-full",compact:!1,disabled:e,icon:t,id:t,onClick:a,text:""},i("calcite-icon",{icon:"cheveron-up",scale:"s",slot:"icon"})),i("calcite-tooltip",{label:"",placement:"bottom","reference-element":t},i("span",null,s)))}_getMapPicker(){const t=this._mapListExpanded?"chevron-up":"chevron-down";return i("calcite-action-group",{class:"action-center width-1-6",layout:"horizontal"},i("calcite-block",{class:"action-center block-button width-full height-full display-grid",heading:"",onClick:()=>this._chooseMap()},i("calcite-icon",{icon:"map",scale:"s",slot:"icon"}),i("calcite-icon",{icon:t,scale:"s",slot:"icon"}),i("calcite-tooltip",{label:"",placement:"bottom"},i("span",null,this._translations.mapName))))}_getMapNameList(t){return i("div",{class:t?"map-list":"display-none"},i("calcite-pick-list",{id:"mapList"},this.mapInfos.map((t=>i("calcite-pick-list-item",{label:t.name,onClick:()=>this._webMapSelected(t.id),selected:t.id===this._loadedId,value:t.id})))))}_webMapSelected(t){this._mapListExpanded=!1,this._webMapId=t}_chooseMap(){this._mapListExpanded=!this._mapListExpanded}_goHome(){alert("go home")}_showList(){alert("show list")}_search(){alert("search")}_zoomIn(){alert("zoom in")}_zoomOut(){alert("zoom out")}_expand(){this.expandMap.emit(p.EXPAND)}async _getTranslations(){const t=await l(this.el);this._translations=t[0]}get el(){return s(this)}static get watchers(){return{_webMapId:["_webMapIdWatchHandler"],mapInfos:["mapInfosWatchHandler"]}}};u.style=":host{display:block;--calcite-label-margin-bottom:0;--calcite-block-padding:0}.action-bar-size{height:3.5rem;width:100%}.action-center{-webkit-box-align:center;-webkit-align-items:center;-ms-grid-row-align:center;align-items:center;align-content:center;justify-content:center}.border-bottom-1{border-width:0px;border-bottom-width:1px;border-style:solid;border-color:var(--calcite-ui-border-3)}.width-1-7{width:14.28%}.width-1-6{width:16.66%}.width-full{width:100%}.height-full{height:100%}.display-flex{display:flex}.display-grid{display:inline-grid}.block-button{border-bottom:0}.block-button:hover{background-color:var(--calcite-ui-foreground-2)}.block-button:active{background-color:var(--calcite-ui-foreground-3)}.map-list{position:absolute;inset:3.5rem 0 0 0;display:flex;flex-direction:column;overflow:hidden;animation:calcite-scrim-fade-in var(--calcite-internal-animation-timing-medium) ease-in-out;background-color:var(--calcite-scrim-background);z-index:1;width:100%;height:-moz-fit-content;height:fit-content}.map-height{height:calc(100% - 58px)}.display-none{display:none}.esri-zoom{display:none !important}";export{m as layer_table,u as map_card}